#!/bin/sh

PASSWORD=("$(keyring get system ladvien.com)")

ECHO ""
ECHO "*******************************************************"
ECHO "* Syncing files to Ladvien.com Jekyll build directory *"
ECHO "*******************************************************"
bundle exec jekyll build --source /Users/caseybrittain/ladvien.github.io --destination /Users/caseybrittain/ladvien.github.io/_site

ECHO ""
ECHO "*******************************************************"
ECHO "* Moving raw_images into images                       *"
ECHO "*******************************************************"
rsync -h -v -r -P -t --ignore-existing /Users/caseybrittain/ladvien.github.io/raw_images/* /Users/caseybrittain/ladvien.github.io/images
rake

ECHO ""
ECHO "****************************"
ECHO "* Updating Jekyll includes *"
ECHO "****************************"

sshpass -p "$PASSWORD" rsync -avzu /Users/caseybrittain/ladvien.github.io/_site/* root@ladvien.com:/usr/share/nginx/html
sshpass -p "$PASSWORD" rsync -avzu /Users/caseybrittain/ladvien.github.io/raw_images/* root@ladvien.com:/usr/share/nginx/html/raw_images/

cd /Users/caseybrittain/ladvien.github.io
git add .
ECHO ""
ECHO "****************************"
echo '* Enter the commit message *'
ECHO "****************************"
git commit -m "Blogging $(date +%Y-%m-%d)"
git push
ECHO ""
ECHO "**************************"
ECHO "* Sending to Ladvien.com *"
ECHO "**************************"
