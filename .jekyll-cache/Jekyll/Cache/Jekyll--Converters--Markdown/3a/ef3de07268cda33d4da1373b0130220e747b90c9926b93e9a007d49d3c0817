I"Ñ~<p>Iâ€™m fat.  Fatter than I want to be.  Iâ€™ve not always been fat, I got down to 180 at back in 2008.  It took counting calories and weight religiously.  The key piece for me was having a graph which I looked at daily showing my outcomes.  Over the course of a year I lost 40 pounds.  Well, itâ€™s time to do it again.  Iâ€™ve gained that 40 back over 10 yearsâ€“and now it needs to go.</p>

<p>Back in 2008 I was using Google to give me the calories of every item I ate and recording them in an Excel document.  This food journal was great, but a little more work than it probably should have been.</p>

<p>Back then, I wasnâ€™t aware of being a hacker.  Now, I plan to throw all my hacker skills at this weight loss plan (hell, I might even go to the gym!)</p>

<p>I signed up for MyFitnessPal.  Counting calories worked once, I figure if it aint broke.  But then I got to looking at how much work it would take to look at my improvement.  I mean, Iâ€™d have to actually open the app on my phone and click on the weight loss section.  Sheshâ€“who designed that app?  Two actions to get where I neededâ€“ainâ€™t no one got time for that.</p>

<p>Enter hacker skills.  I discovered there is a Python library which allows scraping of data.</p>

<ul>
  <li><a href="https://github.com/coddingtonbear/python-myfitnesspal">MyFitnessPal Python Library</a></li>
</ul>

<p>This wonderful little library is written and provided by CoddingtonBear.</p>

<p>I figure, Iâ€™d write a Python script to scrap the data, save it to a CSV, create an SQL-R script to join the nutrition and weight information, use ggplot to plot the data, save the plot as a PNG, and then copy this plot to a dedicated spot on Ladvien.com.  Lastly, Iâ€™d write a bash script to run every night and update the graph.  Simples!</p>

<p>And câ€™mon, opening a webpage is <em>a lot</em> easier than tapping twice.</p>

<p>Well, after a few hours of coding, Iâ€™ve got the first step of the project complete.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">myfitnesspal</span>
<span class="kn">import</span> <span class="nn">csv</span><span class="p">,</span> <span class="n">sys</span><span class="p">,</span> <span class="n">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Get account info
</span><span class="n">client</span> <span class="o">=</span> <span class="n">myfitnesspal</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="s">'cthomasbrittain'</span><span class="p">)</span>
<span class="c1"># Set start year
</span><span class="n">startYear</span> <span class="o">=</span> <span class="s">"2008"</span>
<span class="c1"># Get limits
</span><span class="n">beginningDate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">startYear</span><span class="p">,</span> <span class="s">"</span><span class="si">%</span><span class="s">Y"</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="n">beginningYear</span> <span class="o">=</span> <span class="n">beginningDate</span><span class="o">.</span><span class="n">year</span>
<span class="n">daysInMonth</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span><span class="mi">31</span><span class="p">}</span>
<span class="n">emptyNutrition</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"################################################"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"# Scraping MyFitnessPal                        #"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"# Make sure your account is set to public      #"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"# and your username and pass are in keychain   #"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"################################################"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>

<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="n">currentYear</span> <span class="o">=</span> <span class="n">today</span><span class="o">.</span><span class="n">year</span>

<span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"################################################"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"# Get nutrition and weight information         #"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"################################################"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>

<span class="c1"># Loop over years from beginingYear.  Make sure last year is inclusive.
</span><span class="k">for</span> <span class="n">yearIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">beginningYear</span><span class="p">,</span> <span class="n">currentYear</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    
    <span class="c1"># Create a file name based on this year's data
</span>    <span class="n">thisFileName</span> <span class="o">=</span> <span class="s">"healthData_</span><span class="si">%</span><span class="s">s.csv"</span> <span class="o">%</span> <span class="n">yearIndex</span>

    <span class="c1"># Open CSV as read and write.
</span>    <span class="c1"># If file exists, open for read / write
</span>    <span class="c1">#   else, create file, write only.
</span>    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">thisFileName</span><span class="p">,</span> <span class="s">"r+"</span><span class="p">)</span>        <span class="c1"># Check to see if file is complete,
</span>        <span class="n">row_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>     <span class="c1"># else, overwrite the file
</span>        <span class="k">if</span><span class="p">(</span><span class="n">row_count</span> <span class="o">!=</span> <span class="mi">366</span><span class="p">):</span>               <span class="c1"># A year of rows plus headers, and an empty line at end.
</span>            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">thisFileName</span><span class="p">,</span> <span class="s">"w+"</span><span class="p">)</span>
            <span class="n">row_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="nb">EnvironmentError</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">thisFileName</span><span class="p">,</span> <span class="s">"w+"</span><span class="p">)</span>        <span class="c1"># If file does not exist, create it.
</span>        <span class="n">row_count</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    
    <span class="c1"># Check number of lines. If the year wasn't captured, start over.
</span>    <span class="k">if</span><span class="p">(</span><span class="n">row_count</span> <span class="o">&lt;</span> <span class="mi">365</span><span class="p">):</span>
        <span class="c1"># Write headers for totals
</span>        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s">"Date"</span><span class="p">,</span> <span class="s">"Sodium"</span><span class="p">,</span> <span class="s">"Carbohydrates"</span><span class="p">,</span> <span class="s">"Calories"</span><span class="p">,</span> <span class="s">"Fat"</span><span class="p">,</span> <span class="s">"Sugar"</span><span class="p">,</span> <span class="s">"Protein"</span><span class="p">,</span> <span class="s">"Weight"</span><span class="p">])</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">yearIndex</span><span class="p">)</span><span class="o">+</span><span class="s">": "</span><span class="p">)</span>   <span class="c1"># Print has a linefeed.
</span>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">monthIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                
            <span class="n">beginningOfMonthStr</span> <span class="o">=</span> <span class="s">"</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">yearIndex</span><span class="p">,</span> <span class="n">monthIndex</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">endOfMonthStr</span> <span class="o">=</span> <span class="s">"</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">yearIndex</span><span class="p">,</span> <span class="n">monthIndex</span><span class="p">,</span> <span class="n">daysInMonth</span><span class="p">[</span><span class="n">monthIndex</span><span class="p">])</span>

            <span class="n">beginningOfMonth</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">beginningOfMonthStr</span><span class="p">,</span> <span class="s">"</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d"</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
            <span class="n">endOfMonth</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">endOfMonthStr</span><span class="p">,</span> <span class="s">"</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d"</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
            
            <span class="n">thisMonthsWeights</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">get_measurements</span><span class="p">(</span><span class="s">'Weight'</span><span class="p">,</span> <span class="n">beginningOfMonth</span><span class="p">,</span> <span class="n">endOfMonth</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">dayIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">daysInMonth</span><span class="p">[</span><span class="n">monthIndex</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                
                <span class="n">fullDateIndex</span> <span class="o">=</span> <span class="s">"</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s-</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">yearIndex</span><span class="p">,</span> <span class="n">monthIndex</span><span class="p">,</span> <span class="n">dayIndex</span><span class="p">)</span>
                <span class="n">thisDate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">fullDateIndex</span><span class="p">,</span> <span class="s">"</span><span class="si">%</span><span class="s">Y-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">d"</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
                <span class="k">if</span><span class="p">(</span><span class="n">thisDate</span> <span class="o">&gt;</span> <span class="n">today</span><span class="p">):</span>
                    <span class="k">break</span><span class="p">;</span>

                <span class="n">thisDaysNutritionData</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_date</span><span class="p">(</span><span class="n">yearIndex</span><span class="p">,</span> <span class="n">monthIndex</span><span class="p">,</span> <span class="n">dayIndex</span><span class="p">)</span>
                <span class="n">thisDaysNutritionDataDict</span> <span class="o">=</span> <span class="n">thisDaysNutritionData</span><span class="o">.</span><span class="n">totals</span>
                <span class="n">thisDaysNutritionValues</span> <span class="o">=</span> <span class="n">thisDaysNutritionDataDict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

                <span class="n">thisDaysWeight</span> <span class="o">=</span> <span class="p">[(</span><span class="n">thisMonthsWeights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">thisDate</span><span class="p">))]</span>
                
                <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">thisDaysNutritionValues</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">):</span>
                    <span class="n">thisDaysNutritionValues</span> <span class="o">=</span> <span class="n">emptyNutrition</span>

                <span class="n">dataRow</span> <span class="o">=</span> <span class="p">[</span><span class="n">fullDateIndex</span><span class="p">]</span> <span class="o">+</span> <span class="n">thisDaysNutritionValues</span>  <span class="o">+</span> <span class="n">thisDaysWeight</span>
                <span class="k">if</span> <span class="n">dataRow</span><span class="p">:</span>
                    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">dataRow</span><span class="p">)</span>

            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">"#"</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">" -- Done."</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">yearIndex</span><span class="p">)</span><span class="o">+</span><span class="s">": Exists and is complete."</span><span class="p">))</span></code></pre></figure>

<p>And then we add some R to join the data together and automate plotting, and saving the plots as images.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span><span class="w">

</span><span class="n">cat</span><span class="p">(</span><span class="s2">"*******************************************************\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"* Starting R                                          *\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"*******************************************************\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"*******************************************************\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"* Combining Health Data                               *\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"*******************************************************\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Thanks Rich Scriven</span><span class="w">
</span><span class="c1"># https://stackoverflow.com/questions/25509879/how-can-i-make-a-list-of-all-dataframes-that-are-in-my-global-environment</span><span class="w">
</span><span class="n">healthDataRaw</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">list.files</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">".csv"</span><span class="p">),</span><span class="w"> </span><span class="n">read.csv</span><span class="p">))</span><span class="w">
</span><span class="c1"># Fill in missing values for calories</span><span class="w">
</span><span class="n">healthDataRaw</span><span class="o">$</span><span class="n">Calories</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">healthDataRaw</span><span class="o">$</span><span class="n">Calories</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">healthDataRaw</span><span class="o">$</span><span class="n">Calories</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="n">date30DaysAgo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Sys.Date</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">30</span><span class="w">
</span><span class="n">date90DaysAgo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Sys.Date</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">90</span><span class="w">
</span><span class="n">date180DaysAgo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">Sys.Date</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">180</span><span class="w">

</span><span class="n">cat</span><span class="p">(</span><span class="s2">"*******************************************************\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"* Creating Weight Graph                               *\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"*******************************************************\n"</span><span class="p">)</span><span class="w">
</span><span class="n">healthData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">healthDataRaw</span><span class="p">[</span><span class="o">!</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">healthDataRaw</span><span class="o">$</span><span class="n">Weight</span><span class="p">)),]</span><span class="w">
</span><span class="n">healthData</span><span class="o">$</span><span class="n">Date</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">healthData</span><span class="o">$</span><span class="n">Date</span><span class="p">)</span><span class="w">
</span><span class="n">healthData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">with</span><span class="p">(</span><span class="n">healthData</span><span class="p">,</span><span class="w"> </span><span class="n">healthData</span><span class="p">[(</span><span class="n">Date</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">date30DaysAgo</span><span class="p">),</span><span class="w"> </span><span class="p">])</span><span class="w">
</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">healthData</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Weight</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"firebrick"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="s2">"Ladvien's Weight"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Date"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Weight"</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="w">
</span><span class="n">ggsave</span><span class="p">(</span><span class="s2">"ladviens_weight.png"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">

</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">)</span><span class="w">

</span><span class="n">cat</span><span class="p">(</span><span class="s2">"*******************************************************\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"* Creating Calories Graph                             *\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"*******************************************************\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
</span><span class="c1">#healthData &lt;- healthDataRaw[!(is.na(healthDataRaw$Calories)),]</span><span class="w">
</span><span class="n">healthData</span><span class="o">$</span><span class="n">Date</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.Date</span><span class="p">(</span><span class="n">healthData</span><span class="o">$</span><span class="n">Date</span><span class="p">)</span><span class="w">
</span><span class="n">healthData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">with</span><span class="p">(</span><span class="n">healthData</span><span class="p">,</span><span class="w"> </span><span class="n">healthData</span><span class="p">[(</span><span class="n">Date</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">date30DaysAgo</span><span class="p">),</span><span class="w"> </span><span class="p">])</span><span class="w">
</span><span class="n">p2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">healthData</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Calories</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"firebrick"</span><span class="p">)</span><span class="w"> 
</span><span class="n">p2</span><span class="w">

</span><span class="n">png</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">"ladviens_calories.png"</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">

</span><span class="n">cat</span><span class="p">(</span><span class="s2">"*******************************************************\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"* Finished R Script                                   *\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"*******************************************************\n"</span><span class="p">)</span><span class="w">
</span><span class="n">cat</span><span class="p">(</span><span class="s2">"\n"</span><span class="p">)</span></code></pre></figure>

<p>Lastly, letâ€™s write a bash script to run the Python and R code, then copy the images to Ladvien.com</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/sh</span>
<span class="nv">PASSWORD</span><span class="o">=(</span><span class="s2">"</span><span class="si">$(</span>keyring get system ladvien.com<span class="si">)</span><span class="s2">"</span><span class="o">)</span>

Python myfitnesspall_scraper.py

Rscript myfitnesspal_data_sort.R

ECHO <span class="s2">""</span>
ECHO <span class="s2">"*******************************************************"</span>
ECHO <span class="s2">"* Syncing files to Ladvien.com                        *"</span>
ECHO <span class="s2">"*******************************************************"</span>
ECHO <span class="s2">""</span>

<span class="c"># Used SSHPass</span>
<span class="c"># https://gist.github.com/arunoda/7790979</span>

sshpass <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$PASSWORD</span><span class="s2">"</span> scp ladviens_weight.png ladviens_calories.png root@ladvien.com:/usr/share/nginx/html/images</code></pre></figure>

<p>And hereâ€™s the result:</p>

<p>My weight:</p>

<p><img src="../images/ladviens_weight.png" alt="" /></p>

<p>And my calories:</p>

<p><img src="../images/ladviens_calories.png" alt="" /></p>

<p>Next, Iâ€™ll probably tweak ggplot2 to make the graphs a little prettier.  Also, Iâ€™ll setup a Raspberry Pi or something to run the bash script once a night. Why? Lolz.</p>
:ET