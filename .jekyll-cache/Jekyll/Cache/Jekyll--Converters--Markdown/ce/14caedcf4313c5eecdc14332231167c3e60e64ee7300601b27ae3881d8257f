I"∫&<p><img src="../images/attiny-hm-10-prep-tsb-1.jpg" alt="" /></p>
<h2 id="lumi5--avr--arduino-wireless-uploader">Lumi5 ‚Äì AVR / Arduino Wireless Uploader</h2>
<p>This article will focus on setting up the Bluetooth 4.0 module, preparing the uploader, and uploading sketches over Bluetooth 4.0</p>

<p>Prerequisites:</p>

<p>This article builds off:</p>

<p><a href="https://ladvien.com/burning-tinysafeboot-using-arduino-isp/">Upload Arduino Sketches to ATtiny85 with UART</a></p>

<p>The above article will need to be followed to prepare your ATtiny85 and Windows computer.</p>

<ol>
  <li>ATtiny85 (or any ATtiny or ATmega chip)</li>
  <li>Arduino Uno (or compatible, this will be used once to burn the bootloader to the ATtiny85).</li>
  <li><a href="http://www.ebay.com/itm/NF-FTDI-FT232RL-USB-to-TTL-Serial-Converter-Adapter-Module-5V-3-3V-For-Arduino-/221847346354">FTDI</a> (or compatible UART).</li>
  <li>Lumi (a browser based uploader for TinySafeBoot).</li>
  <li><a href="https://www.arduino.cc/en/Main/Software">Arduino IDE</a></li>
  <li><a href="https://sourceforge.net/projects/winavr/">AVRDUDE</a></li>
  <li><a href="http://www.ebay.com/itm/Tinysine-Serial-Bluetooth-4-0-BLE-Module-iBeacon-IOS-Iphone-Andorid-/221390932333?hash=item338bed896d:g:abcAAMXQ1d1THXrR">HM-10 or HM-11 Breakout</a>*</li>
  <li>1k Resistor</li>
  <li>Soldering iron</li>
</ol>

<p>*Note: There are much cheaper versions of the <a href="http://www.ebay.com/sch/i.html?_odkw=hm-10&amp;_sop=15&amp;_osacat=12576&amp;_from=R40&amp;_trksid=p2045573.m570.l1313.TR0.TRC0.H0.Xhm-10+breakout.TRS0&amp;_nkw=hm-10+breakout&amp;_sacat=12576">breakout listed on eBay</a>, but beware, there are many clones which will not work with this project. The one I‚Äôve listed I‚Äôve verified as working. Of course, I always recommend you <a href="https://www.instructables.com/id/How-to-Create-an-Arduino-Compatible-Bluetooth-40-M/">roll your own breakout</a> :)</p>

<p>Why?</p>

<p>Over-the-air uploading of programs to embedded devices is one of the more useful implementations in the history of embedded hardware. It allows the post-production and delivery of gadgets to have their behavior tweaked in reaction to end-user feedback.</p>

<p>Likewise, the Arduino phenomenon probably needs little explanation in this venue. However, I‚Äôve personally not found many solutions for over-the-air uploading of Arduino sketches which have acceptable trade-offs. This article, along with the preceding, are nothing more than attempts to share what I‚Äôve found.</p>

<h2 id="overview">Overview:</h2>

<p><img src="../images/attiny-hm-10-prep-tsb-2.jpg" alt="" /></p>

<p>This is simply for those who are curious on how this works, it may be skipped.</p>

<p>This tutorial will show you how to wirelessly upload Arduino sketches to an ATtiny85 over a PC‚Äôs built in Bluetooth 4.0 hardware and an HM-10. The concept is fairly simple.</p>

<p>The HM-10 has firmware which allow it to monitor all incoming serial data for AT commands. It can then intercept these commands from the stream, allowing the user to remotely control the behavior of the HM-10. In short, the HM-10 allows you to send a command to send a pin HIGH or LOW.</p>

<p>Now, the TinySafeBootloader is a serial bootloader for the ATtiny and ATmega AVR chip sets (these are the heart of Arduino). The most important difference between the TinySafeBootloader and others is it allows serial control over the bootloader behavior, this allows programmers to write uploader software for it, which is what I‚Äôve done for this project.</p>

<p>To the point, we will wire up an HM-10 and an ATtiny with the TSB bootloader. One of the HM-10‚Äôs IO pins will be connected to the ATtiny‚Äôs RESET line. This will allow us to send a command to the remote HM-10, sending the ATtiny85 into bootloader mode, upload a sketch over the Bluetooth connection, then send another command to the HM-10 to send the ATtiny85 back into program execution mode.</p>

<h2 id="setup">Setup</h2>

<h3 id="select-a-pin">Select a Pin</h3>
<p>You will need to select a IO pin on the HM-10 to connect the 1k resistor. Any of the pins listed above should be supported.
<img src="../images/attiny-hm-10-prep-tsb-3.jpg" alt="" /></p>

<h3 id="solder-the-1k-resistor">Solder the 1k Resistor</h3>

<p>After you have selected the IO pin you would like to use, solder a 1k resistor to the castellated (the half-via leads) on the HM-10.</p>

<p>A few notes:</p>

<p>This is not as hard as it looks; believe in yourself
Flux and a fine-tip iron are helpful, but required
Tweezers allow you to work angles.
<a href="https://jet.com/product/detail/bfbbcfea4f2b450abb35083231522c2f?jcmp=pla:ggl:gen_jd_office_supplies_a3:general_office_supplies_mounting_putty_a3_other:na:PLA_344948460_23657809380_pla-154643897340:na:na:na:2&amp;code=PLA15&amp;ds_c=gen_jd_office_supplies_a3&amp;ds_cid&amp;ds_ag=general_office_supplies_mounting_putty_a3_other&amp;product_id=bfbbcfea4f2b450abb35083231522c2f&amp;product_partition_id=154643897340&amp;gclid=Cj0KEQjw4pO7BRDl9ePazKzr1LYBEiQAHLJdR-oUE22XqS7e9hLmUcQZfVej2JZ1BSIbo7coDJ3onLcaAtHF8P8HAQ&amp;gclsrc=aw.ds">Tacky-putty</a> helps hold the board in place, leaving both hands free to hold components.</p>

<div class="flex-video">
<iframe width="560" height="315" src="https://www.youtube.com/embed/BqkU3-iWdIU" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen=""></iframe>
</div>

<p><img src="../images/attiny-hm-10-prep-tsb-4.jpg" alt="" />
<img src="../images/attiny-hm-10-prep-tsb-9.jpg" alt="" /></p>

<h3 id="configure-the-hm-10-firmware-for-remote-uploading">Configure the HM-10 Firmware for Remote Uploading</h3>
<p><img src="../images/attiny-hm-10-prep-tsb-6.jpg" alt="" /></p>

<p>Before the uploader will work, the HM-10 must be set as a peripheral device and remote transmission mode.</p>

<ol>
  <li>Connect the FTDI chip to the HM-10 breakout, as shown.</li>
  <li>Open the Arduino IDE.</li>
  <li>Select the COM port connected to your FTDI chip</li>
  <li>Open the Serial terminal</li>
  <li>Make sure the terminal is set to, ‚ÄúNo line ending‚Äù</li>
  <li>Type AT+ROLE0 and hit ‚ÄúSend‚Äù. The response ‚ÄúOK+Set:0‚Äù come up.</li>
  <li>Now, type AT+MODE2 and hit ‚ÄúSend. The response should be ‚ÄúOK+Set:2‚Äù.</li>
</ol>

<p><img src="../images/attiny-hm-10-prep-tsb-7.jpg" alt="" /></p>

<p>Optional:</p>

<ol>
  <li>You can set the HM-10‚Äôs baud rate up to 57,600 (it gets iffy above this rate). This allows the bootloader to run more quickly. Here are the commands:
    <ul>
      <li>AT+BAUD0 = 9600</li>
      <li>AT+BAUD1 = 19200</li>
      <li>AT+BAUD2 = 38400</li>
      <li>AT+BAUD3 = 57600</li>
    </ul>
  </li>
  <li>You can change the name of your device using ‚ÄúAT+NAMExxxxxxxx‚Äù.</li>
</ol>

<h3 id="wire-it-up">Wire It Up</h3>

<p><img src="../images/attiny-hm-10-prep-tsb-8.jpg" alt="" /></p>

<p>The following connections will need to be made:</p>

<p>VCC should be 5V</p>

<h3 id="compile-a-sketch-to-upload">Compile a Sketch to Upload</h3>

<p>In the Arduino IDE, write a program you want to upload to your wireless TSB setup. <em>However</em>, instead of using the Arduino to upload the file, we are going to use it only to compile.  To do this, go to <em>Sketch -&gt; Export Compiled Binary</em>  Then, select <em>Sketch -&gt; Show Sketch Folder</em>.  In this folder there will be two .HEX files.  You want the one which does not have ‚Äú‚Ä¶_with_bootloader.ino‚Äù.  (Since, we already have a bootloader installed on our ATtiny.)</p>

<h3 id="connect-to-the-hm-10-module-from-lumi5">Connect to the HM-10 Module from Lumi5</h3>

<p>I‚Äôve provided a web based uploader for TinySafeBoot.  A couple of notes, it only works in Chrome on Linux and Mac.</p>

<p>Before attempting to use the uploader, please open Chrome and type:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">chrome://flags/#enable-experimental-web-platform-features</code></pre></figure>

<p>To get Chrome‚Äôs ‚Äúexperimental‚Äù Bluetooth LE web API to work we have to turn it on.  Go ahead and select <em>Enable</em>.</p>

<h3 id="lumi5">Lumi5</h3>
<p>Go ahead and navigate to:</p>

<ul>
  <li><a href="https://ladvien.com/projects/lumi5/lumi5.html">Lumi5</a></li>
</ul>

<p>This is the work-in-progress web based TinySafeBoot loader I‚Äôve been working on.  The HM-10 uploader is functional, though.</p>

<p>Turn on your HM-10.  Select <em>Bluetooth</em> from the dropdown box and hit <em>Search</em>.  If all has gone well, then you will see the name of your HM-10 module listed.  Go ahead and connect to it.</p>

<p>Now, in the <em>Pin #</em> box, type the pin number corresponding with the pin on your HM-10 which you are using to reset the TinySafeBootloader.</p>

<p><img src="../images/attiny-hm-10-prep-tsb-9.png" alt="" /></p>

<p>Select the multi-gear button.  This should give you a bootloader handshake button.  Try it.  It may take a couple of tries, but you should see the bootloader respond with the device signature and memory information.</p>

<p>If all went well, go ahead and click the Upload File button.  Select the compiled HEX file from the <em>Compile a Sketch</em> step and hit upload.</p>

<p>Cross your fingers.  It should respond with tell you it has written the file.</p>

<p><strong>Important</strong>: Go ahead and refresh the webpage and reconnect.  Once you‚Äôve reconnected, the program you uploaded should be running.</p>

<p>We setup the HM-10 to hold the reset line low when the module is not connected, this is to save power.  But it can be frustrating if your unaware of the setup, as it‚Äôs difficult to troubleshoot.  ‚ÄúWhy the heck isn‚Äôt the program running!?‚Äù</p>

<p>Please, <em>please</em> be kind and provide feedback.  This is a work-in-progress, using a lot of custom hardware and experimental code.</p>

<p>List any questions below and I‚Äôll try to troubleshoot ASAP.</p>
:ET